<wxs module="fn">
	module.exports = {
	search: function(str) {
		return str.search('gif');
		}
	}
</wxs>
<view class="container">
	<!-- 下拉刷新 -->
	<view wx:if="{{ isRefreshing }}" class="weui-loadmore">
		<view class="weui-loading"></view>
		<!-- <view class='weui-loadmore-tips'>加载中...</view> -->
	</view>
	<view class="header" style="background-image: linear-gradient(-90deg, #{{ detail.color[0] }} 0%, #{{ detail.color[1] }} 100%);">
		<view class="left">
			<image mode="aspectFill" class="img" src="{{ circle.image }}"></image>
			<view class="text">
				<view class="textBox">
					<text class="name">{{ circle.title }}</text>
					<image src="/images/smalle.png" catchtap="showbig"></image>
				</view>
				<navigator class="member" url="../member/member?id={{ circle.id }}&name={{ circle.title }}" hover-class="none" open-type="navigate">
					{{ circle.members }}名成员
					<image mode="aspectFill" class="icon" src="{{ $state.imgHost }}/Return.png"></image>
				</navigator>
			</view>
		</view>
		<view class="join joined" wx:if="{{ circle.joined == 1 }}">已加入</view>
		<view class="join" wx:else bindtap="join">加入</view>
	</view>
	<view class="wrap">
		<view wx:for="{{ list }}" wx:key="index" class="item">
			<view class="top">
				<view class="left">
					<view class="avatarUrl" style="border:{{item.is_cert ? '2rpx solid rgba(253,169,0,1);' :''}}">
						<image mode="aspectFill" src="{{ item.avatar }}" data-item="{{ item }}" catchtap="toUser" lazy-load></image>
						<image class="fs" src="/images/approve.png" wx:if="{{item.is_cert}}"></image>
					</view>
					<view class="text">
						<view class="nickName line">
							{{ item.nickname }}
						</view>
						<text class="date">{{ item.createtimes }}</text>
						<text wx:if="{{ item.university_name }}" class="school">{{ item.university_name }}</text>
					</view>
				</view>
				<view class="right">
					<view class="attension" wx:if="{{!item.is_follow && $state.userInfo.id != item.uid}}" data-index="{{index}}" data-userid="{{item.uid}}" data-name="{{item.nickname}}" catchtap="attention">关注</view>
					<view class="collect" catchtap="collect" data-id="{{item.id}}" data-status="{{item.collectstatus}}" data-index="{{index}}" data-userid="{{item.uid}}" data-follow="{{item.is_follow}}" data-name="{{item.nickname}}">...</view>
				</view>
			</view>
			<view catchtap="navigate" data-id="{{ item.id }}">
				<rich-text wx:if="{{ item.content }}" class="name" nodes="{{ item.content }}"></rich-text>
				<view class="content" wx:if="{{ item.images.length > 0 }}">
					<view class="img one" wx:if="{{ item.images.length == 1 }}">
						<image mode="widthFix" wx:for="{{ item.images }}" wx:for-item="items" wx:key="index" src="{{ fn.search(item.images[0]) > 0 ?  item.images : item.image_compress + '/resize,p_50' }}" data-urls="{{ item.images }}" data-current="{{ items }}" catchtap="previewImage"></image>
					</view>
					<view class="img three" wx:else>
						<image mode="aspectFill" wx:for="{{ item.images }}" wx:for-item="items" wx:key="index" src="{{ fn.search(item.images[index]) > 0 ? item.images[index] : item.image_compress[index] + '/resize,m_fixed,w_216,h_216' }}" data-urls="{{ item.images }}" data-current="{{ items }}" catchtap="previewImage"></image>
					</view>
				</view>
				<view class="content" wx:if="{{ item.url && item.duration == 0}}">
					<view class="bg">
						<image mode="aspectFill" src="{{ item.auditing ? $state.imgHost + '/tip.jpg' : item.image }}" class="poster"></image>
						<image mode="aspectFill" src="{{ $state.imgHost }}/play-hl.png" class="play"></image>
					</view>
				</view>
			</view>
			<view class="voiceBox" wx:if="{{item.url && item.duration > 0}}" bindtap="checkRecord" data-duration="{{item.duration}}" data-record="{{item.url}}" data-timer="{{item.timer}}" data-id="{{item.id}}">
				<view class="voiceBoxRight">
						<image src="{{item.id != playVoice.id ? $state.imgHost + '/triangle.png' : $state.imgHost + '/voicepause.png'}}"></image>
						<viwe class="centerImg {{ playVoice.status && item.id == playVoice.id ? 'centerActive' : ''}}"></viwe>
						<view class="timer" wx:if="{{item.id != playVoice.id}}">0{{item.timer.minute}}:{{item.timer.second > 9 ?item.timer.second : '0' + item.timer.second}}</view>
						<view class="timer" wx:else>0{{playVoice.playTiemr.minute}}:{{playVoice.playTiemr.second > 9 ? playVoice.playTiemr.second : '0' + playVoice.playTiemr.second}}</view>
				</view>
			</view>
			<view class="likeComment" wx:if="{{ item.like_avatar_list[0] || item.last_comment.nickname}}">
				<view class="likesavatar"  wx:if="{{item.like_avatar_list[0] && item.likes!= 0 }}" style="margin-bottom: {{ item.last_comment.nickname ? '' : '20rpx'}};">
					<view class="likesLeft">
						<image wx:for="{{item.like_avatar_list}}" wx:for-item="linkeItem" wx:for-index="likeIndex" wx:key="likeIndex" src="{{linkeItem}}"></image>
					</view>
				</view>
				<view class="lastComment" wx:if="{{item.last_comment.nickname}}" catchtap="navigate" data-id="{{ item.id }}">
					<view class="lastContet">
						<text>{{item.last_comment.nickname}}: </text>
						<rich-text nodes="<div style='overflow:hidden;white-space:nowrap;text-overflow:ellipsis;'>{{ item.last_comment.content }} </div>"></rich-text>
					</view>
				</view>
			</view>
			<navigator wx:if="{{ item.fs_title }}" url="../cDetail/cDetail?id={{ item.fs_id }}"
			hover-class="none" open-type="navigate" class="label" style="margin: {{ !item.like_avatar_list[0] && !item.last_comment.nickname ? '30rpx 30rpx 0 30rpx' : '0 30rpx 20rpx 30rpx'}};"> #{{ item.fs_title }}精选</navigator>
			<view class="btn" style="margin-top:{{!item.like_avatar_list[0] && !item.last_comment.nickname ? '30rpx' : ''}}">
				<!-- 点赞 -->
				<view class="item" bindtap="praise" data-index="{{ index }}">
					<view class="praise  {{ item.likestatus ? 'end' : '' }} {{ item.praising ? 'ani' : '' }}" data-index="{{ index }}" bindanimationend="aniend"></view>
					<text class="text">{{ item.likes != 0 ? item.lw || item.likes : '点赞' }} </text>
				</view>
				<text class="division"></text>
				<!-- 评论 -->
				<navigator url="../pDetail/pDetail?id={{ item.id }}&comment" hover-class="none" open-type="navigate" class="item">
					<icon class="iconfont icon-comment"></icon>
					<text class="text">{{ item.comments != 0 ?  item.cw || item.comments : '评论' }}</text>
				</navigator>
				<text class="division"></text>
				<button class="share item" open-type="share" data-index="{{ index }}" hover-class="btn-hover">
					<icon class="iconfont icon-fenxiang"></icon>
					<text class="text">{{ item.forward != 0 ? item.fw || item.forward : '分享' }}</text>
				</button>
			</view>
		</view>
	</view>
</view>
<view wx:if="{{ rlAni }}" class="popup">
	<view class="publishAni"></view>
</view>
<view class="footer">
	<navigator url="../release/release?title={{circle.title}}&id={{circle.id}}&type=circle" hover-class="none" open-type="navigate" class="write">
		<text class="text">写帖</text>
	</navigator>
</view>
<view class="ewm" bindtap="closeewm" wx:if="{{showbig}}">
	<view class="ewmBox" catch:longpress="longPress">
		<image src="{{circle.group_qrcode_image}}" class="ewmImg"></image>
		<view class="ewmTxt" style="margin-top:20rpx ;">长按图片保存至微信</view>
		<view class="ewmTxt">扫码加入{{circle.title}}社群</view>
	</view>
	<view class="shett" wx:if="{{showT}}">
		<view class="shet-item" catchtap="saveImg">保存到相册</view>
		<view class="shet-item" catchtap="closeT">取消</view>
	</view>
</view>
<view class="ActionSheet" wx:if="{{showSheet}}" bindtap="closeSheet">
	<view class="ActionSheet-box">
		<view class="ActionSheet-item" catchtap="{{is_follow ? 'clsocancelFollowing' : 'attention'}}" wx:if="{{flowId != $state.userInfo.id}}" >
			{{is_follow ? '取消关注' : '关注'}}
		</view>
		<view class="ActionSheet-item" catchtap="{{collectstatus ? 'cancelCollection' : 'setCollect'}}">
			{{collectstatus ? '取消收藏' : '收藏'}}
		</view>
		<view class="ActionSheet-item" catchtap="closeSheet">
			取消
		</view>
	</view>
</view>