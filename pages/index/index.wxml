<!--
 * @Date: 2019-06-11 20:56:43
 * @LastEditors: hxz
 * @LastEditTime: 2019-08-13 12:01:10
 -->
<template name="skeletonTop">
  <view class="top" style="padding-top:{{ topT }}px">
    <view class="avatarBox skeletonaAtive"></view>
    <text class="skeletonaAtive"></text>
  </view>
</template>
<template name="skeletonSwiper">
  <view class="skeletonSwiper">
    <view class="skeletonaAtive"></view>
  </view>
</template>
<template name="skeleton">
  <view class="skeleton" wx:for="{{5}}" wx:key="index">
    <view class="skeletonBox">
      <view class="skeletonImg"></view>
      <view class="skeletonTitle"></view>
      <view class="skeletonContent"></view>
      <view class="skeletonDaram"></view>
      <view class="skeletonDaram"></view>
    </view>
  </view>
</template>
<template name="recommend">
  <view catchtap="detailTap" wx:for="{{ recommend }}" wx:key="index" class="item" data-item="{{ item }}">
    <view class="content {{ type ? '': item.show_big ? 'big' : '' }}">
      <view class="left">
        <image class="poster" mode="aspectFill"
          src="{{ item.show_big ? item.big_image + '?x-image-process=image/resize,m_fixed,w_690,h_360/quality,Q_80' : item.image + '?x-image-process=image/resize,m_fixed,w_260,h_160/quality,Q_80'  }}"
          lazy-load="true"></image>
        <image class="icon" mode="aspectFill" src="{{ $state.imgHost }}/play.png"></image>
        <image src="/images/coursestautes.png" class="status" mode="aspectFill" wx:if="{{item.is_finish}}"
          style="{{item.show_big ? 'width:130rpx;height:72rpx' : ''}}"></image>
      </view>
      <view class="right">
        <text class="line name">{{ item.title }}</text>
        <text class="line actor" wx:if="{{ item.teacher_id == 0 }}">{{ item.subtitle }}</text>
        <text class="line actor" wx:else>{{ item.name }}-{{ item.honor }}</text>
        <text class="line info">
          <text class="dramaNum"><text class="key">剧集</text>{{ item.lesson_count }}集</text>
          <text class="playNum"><text class="key">播放</text>{{ item.bw || item.browse }}</text>
        </text>
      </view>
    </view>
  </view>
</template>
<template name="liveBox">
  <view wx:if="{{recommend[0]}}">
    <view class="liveBox" wx:if="{{liveRecommend[0]}}">
      <view class="topTtile">
        <text>直播推荐</text>
        <navigator class="topTtile-right" url="/page/live/pages/liveCenter/liveCenter" hover-class="none">
          <text>更多课程</text>
          <image src="/images/Return-black.png"></image>
        </navigator>
      </view>
      <view class="comment">
        <view wx:for="{{liveRecommend}}" wx:key="index" class="liveItem"
          style="{{index + 1 > 6 - 2 ? 'border:none' : '' }}" bindtap="toLivelesson" data-item="{{item}}">
          <view class="liveImgBox">
            <image src="{{item.indexCover}}">
            </image>
            <view class="liveStatus"
              style="background: {{ item.status == 1 ? '' : 'linear-gradient(270deg, #44A2FF 0%, #007CF7 100%);' }}">
              <view class="statusLeft" wx:if="{{item.status == 1}}">
                <view wx:for="{{3}}" wx:key="index" class="statusWite"></view>
                <view class="statusTxt">直播</view>
              </view>
              <view class="statusLeft" wx:else>
                <view class="statusTxt" style="margin: 0">未开始</view>
              </view>
            </view>
          </view>
          <text>{{item.name}}</text>
          <text>{{item.date}} {{item.time}}</text>
        </view>
      </view>
    </view>
  </view>
  <view class="liveBox" wx:else>
    <view class="topTtile">
      <text>直播推荐</text>
      <view class="topTtile-right">
        <text>更多课程</text>
        <image src="/images/Return-black.png"></image>
      </view>
    </view>
    <view class="comment">
      <view wx:for="{{6}}" wx:key="index" class="liveItem" style="{{index + 1 > 6 - 2 ? 'border:none' : '' }}">
        <view class="img skeletonaAtive"></view>
        <text class="skeletonaAtive"></text>
        <text class="skeletonaAtive"></text>
      </view>
    </view>
  </view>
</template>
<template name="nomore">
  <view class="nomore">
    <image src="/images/nomore.png"></image>
    <text>没有更多了</text>
  </view>
</template>
<view class="container">
  <!-- 下拉刷新 -->
  <view wx:if="{{ isRefreshing }}" class="weui-loadmore indexdrop">
    <view class="weui-loading"></view>
  </view>
  <view class="top" style="padding-top:{{ topT }}px" wx:if="{{recommend[0]}}" bindtap="toInfo">
    <view class="avatarBox" catchtap="toUser" wx:if="{{$state.authUserInfo}}">
      <image class="img" src="{{$state.userInfo.avatar}}" alt=""></image>
    </view>
    <button class="avatarBox" wx:else open-type="getUserInfo" bindgetuserinfo="onGotUserInfo" data-role="user"
      catchtap="getSomthin">
      <open-data class="img" type="userAvatarUrl"></open-data>
    </button>
    <text>{{$state.userInfo.school || "网上老年大学"}}</text>
  </view>
  <template is="skeletonTop" data="{{topT}}" wx:else></template>
  <!-- 搜索/学分 -->
  <view class="search-box">
    <navigator class="search-left" url="/page/index/pages/search/search">
      <image src="/images/indexIcon/searchp.png"></image>
      <text>搜索课程名称</text>
    </navigator>
    <navigator class="search-right" url="/page/live/pages/timetableList/timetableList" hover-class="none">
      <image src="/images/indexIcon/timetableIcon.png"></image>
      <text>我的课程</text>
    </navigator>
  </view>
  <navigationBar wx:if="{{ scroll }}" id="navigationBar" placeholderBg="#F8F8F8" color="#000000" title="网上老年大学"
    back="{{ false }}" background="#F8F8F8"></navigationBar>
  <view class="nav" wx:if="{{ !recommend }}">
    <view class="integral navintegral">
    </view>
  </view>
  <view class="nav {{ scroll ? 'fixed' : '' }}" style="top:{{ top }}px;padding-right:20px;overflow: hidden;" wx:else>
    <scroll-view class="nav" style="display:flex;padding-right: 20px" scroll-x="true" scroll-left="{{ navScrollLeft }}"
      scroll-with-animation="true" enable-flex scroll-into-view="item{{currentTab < 4 ? 0 : currentTab - 3}}">
      <block wx:for="{{ nav }}" wx:for-index="id" wx:for-item="item" wx:key="index" class="navitem">
        <formCode bind:handler="switchNav" data-current="{{ id }}" data-id="{{item.id}}">
          <view class="item {{ [currentTab == id ? 'active' : '',id == 0 ? 'itemone' : ''] }}"
            style="margin-right:{{id + 1 == nav.length ? '40rpx' : ''}}" id="item{{id}}">{{ item.name }}</view>
        </formCode>
      </block>
    </scroll-view>
    <navigator hover-class="none" class="tabclassify" url="/page/index/pages/drag/drag?index={{currentTab}}">
      <image src="/images/indexIcon/tabclassify.png"></image>
    </navigator>
  </view>
  <swiper class="tab" style="height:{{ height }}px" current="{{ currentTab }}" duration="300" bindchange="switchTab"
    bindtouchstart="touchstart" bindtouchend="touchend">
    <swiper-item class="tab-item">
      <!--推荐  -->
      <view class="wrap recommend" id="recommend1">
        <!-- 广告位banner -->
        <view class="swiperBox" wx:if="{{recommend[0]}}">
          <swiper autoplay interval="3500" duration="200" circular class="swiper" wx:if="{{imgUrls[0].image}}"
            current="{{bannercurrentTab}}" bindanimationfinish="centerTab">
            <block wx:for="{{imgUrls}}" wx:key="index">
              <swiper-item>
                <image src="{{item.image}}" class="slide-image" width="355" height="150" catchtap="bannerGo"
                  data-item="{{ item }}" wx:if="{{!item.is_login}}" />
                <image src="{{item.image}}" class="slide-image" width="355" height="150" catchtap="bannerGo"
                  data-item="{{ item }}" wx:if="{{item.is_login && $state.authUserInfo}}" />
                <button class="slide-image" style="background:url({{item.image}});background-size: 100% 100%;"
                  open-type="getUserInfo" bindgetuserinfo="onGotUserInfo" data-type="banner" data-item="{{item}}"
                  wx:else></button>
              </swiper-item>
            </block>
          </swiper>
          <view class="indicatorBox">
            <view class="indicatorItem {{bannercurrentTab == index ? 'indicatorActive' : ''}}" wx:for="{{imgUrls}}"
              wx:key="index" wx:if="{{imgUrls.length > 1}}"></view>
          </view>
        </view>
        <template is="skeletonSwiper" wx:else></template>
        <!-- 中间icon -->
        <view class="centerIcon">
          <navigator class="iconBox" hover-class="none" url="/pages/video/video">
            <image src="/images/indexIcon/sortVideoicon.png"></image>
            <text>短视频</text>
          </navigator>
          <navigator class="iconBox" hover-class="none" url="/page/index/pages/rankingList/rankingList">
            <image src="/images/indexIcon/studyIcon.png"></image>
            <text>学习榜</text>
          </navigator>
          <navigator class="iconBox" hover-class="none" url="/page/user/pages/score/score"
            wx:if="{{$state.authUserInfo}}">
            <image src="/images/indexIcon/scroeIcon.png"></image>
            <text>学分兑换</text>
          </navigator>
          <button open-type="getUserInfo" bindgetuserinfo="onGotUserInfo" class="iconBox" data-type="score" wx:else>
            <image src="/images/indexIcon/scroeIcon.png"></image>
            <text>学分兑换</text>
          </button>
          <navigator class="iconBox" hover-class="none" url="/page/index/pages/hotActivity/hotActivity">
            <image src="/images/indexIcon/hotActivityIcon.png"></image>
            <text>热门活动</text>
          </navigator>
        </view>
        <template is="liveBox" data="{{recommend, liveRecommend}}"></template>
        <view>
        </view>
        <view class="liveBox">
          <view class="topTtile">
            <text>课程推荐</text>
          </view>
          <template is="skeleton" wx:if="{{ !recommend[0]}}"></template>
          <template is="recommend" data="{{recommend, $state}}" wx:else></template>
        </view>
        <template is="nomore"></template>
      </view>
    </swiper-item>
    <swiper-item class="tab-item" wx:for="{{nav}}" wx:key="index" wx:if="{{!index == 0}}" item-id="{{item.name}}">
      <view class="wrap recommend" id="recommend{{item.id}}">
        <template is="skeleton" wx:if="{{ !catrecommend[item.id][0] }}"></template>
        <template is="recommend" data="{{ recommend:catrecommend[item.id], $state, type: 1}}"></template>
        <template is="nomore" wx:if="{{nav[currentTab].showBtoom}}"></template>
      </view>
    </swiper-item>
  </swiper>
  <!-- 底部tabbar -->
  <navBar path='index'></navBar>
  <!-- 学习历史 -->
  <view class="now" wx:if="{{history.last_lesson}}" bindtap="historyTap" data-id="{{ history.last_lesson.id }}"
    data-title="{{ history.last_lesson.title }}"
    style="animation:{{ history.last_lesson && shownow && shownowt ? 'nowshow' : 'nowclose'}}  0.5s ; bottom:{{history.last_lesson && shownow && shownowt? '138rpx' : '-88rpx'}} ">
    <image src="/images/play-red.png"></image>
    <view class="line">{{ history.last_lesson.title + "第" + history.last_lesson.sub_id + "讲" }}</view>
    <image src="{{$state.imgHost}}/nowcancle.png" catchtap="closenow"></image>
  </view>
  <!-- 签到拿学分 -->
  <!-- <view class="integration" wx:if="{{ !$state.signStatus.count && recommend[0] && !dialog[0].image}}"
    catchtouchmove="return">
    <view class="dialog">
      <image class="bg" src="{{$state.imgHost}}/integrationBg.png" mode="aspectFill"></image>
      <view class="ani" catchtap="signIn" data-id="1"></view>
      <icon type="cancel" size="37" color="white" data-id="0" catchtap="signIn"></icon>
    </view>
  </view> -->
  <!-- 活动弹窗 -->
  <view class="integration" wx:if="{{ recommend[0] && dialog[0].image && showdialog}}" catchtouchmove="return">
    <view class="dialog">
      <view class="bg"
        style="background: url('{{dialog[0].image}}') no-repeat center; background-size: 100% 100%;border-radius:10px"
        src="{{dialog[0].image}}" mode="aspectFill" catchtap="jumpPeper" data-peper="{{dialog[0]}}" data-type="dialog">
      </view>
      <icon type="cancel" size="37" color="white" data-id="0" catchtap="closeSignIn"></icon>
    </view>
  </view>
  <signinBox wx:if="{{ !$state.signStatus.count && recommend[0] && !dialog[0].image && showSignbox}}" state="{{$state}}"
    top="{{topT}}" isIndex="{{true}}" bind:closesignBox="closesignBox" bind:showIntegral="showIntegral"
    bind:sigin="sigin" />
</view>
<navigator url="/page/index/pages/assistant/assistant" hover-class="none">
  <image src="/images/xiaolin.png" class="xiaolin"></image>
</navigator>
<!-- wx:if="{{ $state.newGuide.index == 0 }}" -->
<cover-view class="getGuideBox" wx:if="{{ $state.newGuide.index == 0 }}">
  <cover-view class="numberbox" wx:if="{{guideNum == 1}}">
    <cover-image src="{{$state.imgHost}}/indexguidsearch.png" class="guidsearch" style="top:{{topT + 132}}rpx">
    </cover-image>
    <cover-view class="numberbox-box" catchtap="nextGuide" style="top:{{topT + 200}}rpx">
      <cover-image src="{{$state.imgHost}}/indexguidsearchlabel.png" class="searchlabel"></cover-image>
    </cover-view>
  </cover-view>
  <cover-view class="numberbox" wx:if="{{guideNum == 2}}">
    <cover-image src="{{$state.imgHost}}/indexguidtab.png" class="guidtab" style="top:{{topT + 244}}rpx"></cover-image>
    <cover-view class="gesture" style="top:{{topT + 500}}rpx">
      <cover-image src="{{$state.imgHost}}/videoheng.png" class="indexGuide-img"></cover-image>
      <cover-image src="/images/handleRight.gif" class="indexGuide-imgactive"></cover-image>
    </cover-view>
    <cover-view class="numberbox-boxt" catchtap="nextGuide" style="top:{{topT + 800}}rpx">
      <cover-image src="{{$state.imgHost}}/indexguidtablable.png" class="indexLeft"></cover-image>
    </cover-view>
  </cover-view>
  <cover-view class="numberbox" wx:if="{{guideNum == 3}}">
    <cover-image src="{{$state.imgHost}}/categoryicon.png" class="indexSocre" style="top:{{topT + 265}}rpx">
    </cover-image>
    <cover-view class="numberbox-boxr" catchtap="nextGuide">
      <cover-image src="{{$state.imgHost}}/categoryicontxt.png" class="indexsocermsg"></cover-image>
    </cover-view>
  </cover-view>
</cover-view>

<!-- 黑名单提示框 -->
<view class="blackBox" wx:if="{{$state.blackShow}}">
  <view class="blackToast">
    <view class="blackTxt">您的账号存在异常！如有疑问，请联系客服！</view>
    <view class="btnBox">
      <navigator class="blackBtn" target="miniProgram" open-type="exit" hover-class="none">退出</navigator>
      <button class="blackBtn" open-type="contact">联系客服</button>
    </view>
  </view>
</view>

<!-- 学分动画 -->
<integralAnimation integral="{{integral}}" integralContent="{{integralContent}}" wx:if="{{showintegral}}">
</integralAnimation>