<!--
 * @Date: 2019-06-11 21:01:20
 * @LastEditors: hxz
 * @LastEditTime: 2019-08-12 20:30:54
 -->
<!-- 下拉刷新 -->
<view wx:if="{{ isRefreshing }}" class="weui-loadmore">
  <view class="weui-loading"></view>
</view>
<view class="container">
  <view class="box">
    <view wx:if="{{ vistor && tip }}" class="vistor-head">
      点击“ <icon class="iconfont icon-xiaochengxu"></icon> ”添加到我的小程序
      <!-- <icon class="iconfont icon-shouzhi" style="left:{{ rect.left + 10 }}px"></icon> -->
    </view>
    <view wx:if="{{ detail }}" class="detail">
      <view class="top">
        <view class="left">
          <image mode="aspectFill" class="avatarUrl" src="{{ detail.avatar }}" data-uid="{{ detail.uid }}" catchtap="toUser"></image>
          <view class="text">
            <text class="nickName line">{{ detail.nickname }}</text>
            <text wx:if="{{ detail.university_name }}" class="school line">{{ detail.university_name }}</text>
          </view>
        </view>
        <text class="date">{{ detail.createtimes }}</text>
      </view>
      <rich-text wx:if="{{ detail.content }}" class="name" nodes="{{ detail.content }}"></rich-text>
      <view class="content" wx:if="{{ detail.images.length > 0 }}">
        <view class="img one" wx:if="{{ detail.images.length == 1 }}">
          <image mode="widthFix" wx:for="{{ detail.images }}" wx:for-item="items" wx:key="index" src="{{ items }}" data-urls="{{ detail.images }}" data-current="{{ items }}" catchtap="previewImage"></image>
        </view>
        <view class="img three" wx:if="{{ detail.images.length > 1 }}">
          <image mode="aspectFill" wx:for="{{ detail.images }}" wx:for-item="items" wx:key="index" src="{{ items }}" data-urls="{{ detail.images }}" data-current="{{ items }}" catchtap="previewImage"></image>
        </view>
      </view>
      <view class="content" wx:if="{{ detail.url }}">
        <video wx:if="{{ !detail.pause }}" id="{{ detail.id }}" src="{{ detail.url }}" controls page-gesture enable-play-gesture bindended="ended"></video>
        <view wx:if="{{ detail.pause }}" class="bg" bindtap="play">
          <image mode="aspectFill" src="{{ detail.auditing ? $state.imgHost + '/tip.jpg' : detail.image }}" class="poster"></image>
          <image mode="aspectFill" src="{{ $state.imgHost }}/play-hl.png" class="play" bindtap="play"></image>
        </view>
      </view>
      <button wx:if="{{ detail.fs_title }}" class="label" hover-class="none">#{{ detail.fs_title }}</button>
    </view>
  </view>
  <scroll-view wx:if="{{ detail }}" scroll-x="true" class="nav" scroll-left="{{ navScrollLeft }}" scroll-with-animation="{{ true }}">
    <block wx:for="{{ nav }}" wx:for-index="id" wx:for-item="item" wx:key="id">
      <view class="item {{ currentTab == id ? 'active' : '' }}" data-current="{{ id }}" bindtap="switchNav">{{ item.name + " " + item.num }}</view>
    </block>
  </scroll-view>
  <swiper wx:if="{{ detail }}" class="tab" style="height:{{ height }}px" current="{{ currentTab }}" duration="300" bindchange="switchTab">
    <swiper-item class="tab-item">
      <view class="wrap comment">
        <view class="nodata" wx:if="{{ comment.length <= 0 }}">
          <image src="../../images/no-com.png" mode="aspectFill"></image>
        </view>
        <view wx:for="{{ comment }}" wx:key="index" class="item">
          <view class="content">
            <view class="left">
              <image class="img" mode="aspectFill" src="{{ item.avatar }}"></image>
            </view>
            <view class="right">
              <view class="top">
                <text class="line name">{{ item.nickname }}</text>
                <view class="time-del">
                  <text class="line time">{{ item.createtimes }}</text>
                  <view class="del" wx:if="{{ $state.userInfo.id == item.uid }}" catchtap="delComment" data-item="{{ item }}">
                    <image src="{{ $state.imgHost }}/delete.png" mode="aspectFill" class="icon-del"></image>
                    <text>删除</text>
                  </view>
                </view>
              </view>
              <rich-text nodes="{{ item.content }}"></rich-text>
              <button wx:if="{{ $state.userInfo.id != item.uid }}" class="reply-btn" data-reply="{{ item }}" catchtap="show">回复</button>
            </view>
          </view>
          <view class="children" wx:for="{{ item.reply_array }}" wx:key="index" wx:for-item="child">
            <view class="from_user">
              <view class="user_info">
                <image class="img" mode="aspectFill" src="{{ child.from_user_avatar }}"></image>
                <text class="line name">{{ child.from_user }}</text>
              </view>
              <view class="time-del">
                <text class="line time">{{ child.create_time }}</text>
                <view class="del" wx:if="{{ $state.userInfo.id == child.reply_user_id }}" catchtap="delReply" data-item="{{ child }}" data-parentid="{{ item.id }}">
                  <image src="{{ $state.imgHost }}/delete.png" mode="aspectFill" class="icon-del"></image>
                  <text>删除</text>
                </view>
              </view>
            </view>
            <rich-text nodes="{{ child.rtext + child.reply_content }}"></rich-text>
            <button wx:if="{{ $state.userInfo.id != child.reply_user_id }}" class="reply-btn" data-reply="{{ child }}" data-parent="{{ item.id }}" catchtap="show">回复</button>
          </view>
          <view class="reply_all" wx:if="{{ item.reply_num > 3 }}" data-parentid="{{ item.id }}" catchtap="toCommentDetail"> 查看全部{{ item.reply_num }}条 </view>
        </view>
      </view>
    </swiper-item>
    <swiper-item class="tab-item">
      <view class="wrap praise">
        <view class="nodata" wx:if="{{ praise.length <= 0 }}">
          <image src="../../images/no-com.png" mode="aspectFill"></image>
        </view>
        <view wx:for="{{ praise }}" wx:key="index" class="item">
          <view class="content">
            <view class="left">
              <image class="img" mode="aspectFill" src="{{ item.avatar }}"></image>
              <text class="name">{{ item.nickname }}</text>
            </view>
            <text class="time">{{ item.createtimes }}</text>
          </view>
        </view>
      </view>
    </swiper-item>
  </swiper>
  <view wx:if="{{ detail }}" class="footer">
    <button class="share item" open-type="share" data-id="{{ detail.id }}" hover-class="btn-hover">
      <icon class="iconfont icon-fenxiang"></icon>
      <text class="text">转发</text>
    </button>
    <text class="division"></text>
    <view class="item" bindtap="show">
      <icon class="iconfont icon-comment"></icon>
      <text class="text">评论</text>
    </view>
    <text class="division"></text>
    <view class="item" bindtap="praise">
      <view class="praise  {{ detail.likestatus ? 'end' : '' }} {{ detail.praising ? 'ani' : '' }}" data-index="{{ index }}" bindanimationend="aniend"></view>
      <text class="text">点赞</text>
    </view>
  </view>
  <view class="del_blog" wx:if="{{ delState }}">
    <image src="/images/delBlog.png" mode="aspectFill"> </image>
    <text>帖子已删除~ </text>
  </view>
  <view class="popup write" wx:if="{{ write }}">
    <view class="bg" bindtap="hide"></view>
    <view class="box">
      <!-- prettier-ignore -->
      <textarea placeholder="写评论" focus  cursor-spacing="190rpx"  fixed  bindinput="input" value='{{content}}' placeholder-class="ph-class" ></textarea>
      <!-- prettier-ignore -->
      <view class="right" catchtap="navigator">
        <view class="to">
          <image mode="aspectFit" class="icon" src="{{ $state.imgHost }}/screen.png"></image>
        </view>
        <button class="release" disabled="{{ !content }}" catchtap="release">发布</button>
      </view>
    </view>
  </view>
  <view wx:if="{{ vistor }}" class="vistor-home" catchtap="tohome">
    <icon class="iconfont icon-shouye"></icon>
    <text>首页</text>
  </view>
</view>
